# Development Slices — принцип нарезки на блоки разработки

> Этот документ содержит архитектурное указание для Tech Lead
> по декомпозиции работы на блоки разработки.
>
> Блок разработки (задача) — единица работы, поручаемая
> одной команде аналитик-разработчик-ревьюер.

---

## 1. Принцип: вертикальные срезы

Блоки разработки нарезаются как **вертикальные срезы**
через всю систему, а не как горизонтальные слои.

**Вертикальный срез:** сообщение проходит от входа до выхода
через все задействованные компоненты. Результат среза —
работающая цепочка, которую можно запустить и проверить.

**Горизонтальный слой** (антипаттерн для данного проекта):
отдельно Storage, отдельно EventBus, отдельно DialogueAgent
как изолированные задачи. Проблема — каждый дополнительный
блок порождает проблемы стыковки при интеграции.

---

## 2. Первый срез: сквозной скелет

Критический блок — должен быть реализован первым.
Валидирует всю архитектуру: все компоненты связаны,
данные текут, наблюдаемость работает.

**Что входит:**

```
Хардкодированный SIM (отправляет несколько Messages)
  → DialogueAgent (принимает, отвечает минимально)
    → DialogueBuffer → EventBus(input)
      → простейший ProcessingAgent (минимальная обработка)
        → EventBus(output)
          → OutputRouter (прямая доставка, без логики)
            → DialogueAgent → ответ клиенту

Параллельно:
  EventBus → Tracker → Storage(TraceEvents)
  VS UI → polling API → базовый Timeline
```

**Компоненты — все, но в минимальной реализации:**
- Storage (SQLite) — схема для всех сущностей из data_model.md
- EventBus — pub/sub с персистентностью
- DialogueAgent — приём/ответ, буфер, публикация в шину
- ProcessingAgent — один, простейший (echo или извлечение ключевых слов)
- OutputRouter — прямая пересылка без адресации/агрегации
- Tracker — запись TraceEvents по обоим каналам
- LLMProvider — подключение к одной модели
- VS UI — Timeline, polling
- SIM — хардкодированный сценарий, 2-3 VirtualUsers

**Результат среза:** запускаем SIM, видим в VS UI Timeline
как сообщения проходят полный цикл от входа до выхода.

**Почему это один блок:** разделение на части создаст
именно те проблемы стыковки, которых мы хотим избежать.
Скелет должен быть собран одной командой, чтобы обеспечить
бесшовность прохождения данных через все компоненты.

---

## 3. Последующие срезы

После работающего скелета — углубление отдельных частей.
Конкретная нарезка — ответственность Tech Lead,
но направления очевидны:

- **Содержательная обработка:** реальный ProcessingAgent
  с осмысленной логикой (извлечение задач, анализ контекста)
- **Полноценная наблюдаемость:** все четыре представления VS UI
  (Dialogues, Swimlanes, Agent Reasoning)
- **Полноценный SIM:** Profile + Scenario модель,
  реалистичные диалоги

Порядок и границы этих срезов — решение Tech Lead.
