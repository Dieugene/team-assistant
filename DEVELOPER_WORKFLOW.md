# AI Agent Development Template

Система для организации разработки с использованием AI-агентов в разных ролях.

## Быстрый старт

### 1. Первый запуск - Architect

Начните с агента Architect для обсуждения архитектуры:

```
Ты — агент Architect (см. .agents/architect.md).

Прочитай:
- .agents/architect.md
- AGENTS.md
- Все файлы из 00_docs/standards/common/
- Все файлы из 00_docs/standards/architect/

Задача: Обсуди со мной архитектуру проекта и создай детальное описание.
```

### 2. Tech Lead создает план и задачи

Скопируйте промпт от Architect и передайте Tech Lead. Tech Lead:
- Создает `implementation_plan.md` - план реализации
- Создает `backlog.md` - реестр задач
- Создает первые `task_brief` - постановки задач

### 3. Передача между агентами

**Ключевой принцип: Агенты не общаются напрямую. Вы - посредник.**

Каждый агент в конце работы генерирует промпт для следующего агента. Ваши действия:

1. **Скопируйте промпт** который агент положил в чат
2. **Вставьте в новое сообщение** (или новую сессию если контекст заполнен)
3. **Запустите следующего агента**

## Роли агентов

### Architect (Архитектор)
**Когда запускать:**
- Обсуждение архитектуры проекта
- Принятие архитектурных решений (ADR)
- Эскалация от Tech Lead

**Что делает:**
- Создает `00_docs/architecture/overview.md`
- Создает ADR при архитектурных решениях
- **НЕ** управляет backlog, **НЕ** создает задачи, **НЕ** принимает работу

**Файлы:** `.agents/architect.md`

### Tech Lead (Технический лидер)
**Когда запускать:**
- После создания архитектуры Architect
- Приемка работы от Reviewer
- Эскалация от Developer

**Что делает:**
- Создает `implementation_plan.md` - план реализации
- **Создает и ведет `backlog.md`** - реестр задач
- **Создает `task_brief`** для задач
- Проектирует интерфейсы между компонентами
- **Принимает выполненную работу**

**Файлы:** `.agents/tech-lead.md`

### Developer (Разработчик)
**Когда запускать:**
- После получения задачи от Tech Lead

**Что делает:**
- Пишет код в `02_src/`
- Создает отчет о реализации `implementation_NN.md`
- Эскалирует проблемы к Tech Lead

**Файлы:** `.agents/developer.md`

### Reviewer (Ревьюер)
**Когда запускать:**
- После получения промпта от Developer (код готов)

**Что делает:**
- Проверяет соответствие коду ТЗ и стандартам
- Создает отчет о проверке `review_NN.md`
- Решает: принять (→ Tech Lead) или вернуть Developer

**Файлы:** `.agents/reviewer.md`

## Типичный workflow задачи

```
0. Architect создает архитектуру (overview.md, ADR)
   Architect выдает промпт для Tech Lead
   
1. Вы копируете промпт → Tech Lead
   Tech Lead создает implementation_plan.md
   Tech Lead создает backlog.md
   Tech Lead создает task_brief
   Tech Lead выдает промпт для Developer
   
2. Вы копируете промпт → Developer
   Developer пишет код + implementation_01.md
   Developer выдает промпт для Reviewer
   
3. Вы копируете промпт → Reviewer
   Reviewer проверяет код + review_01.md
   
   Варианты:
   
   А) Все ок → Reviewer выдает промпт для Tech Lead (приемка)
      Вы → Tech Lead принимает работу, обновляет backlog
      
   Б) Проблемы реализации → Reviewer выдает промпт для Developer
      Вы → Developer исправляет + implementation_02.md
      Вы → Reviewer проверяет + review_02.md
      ... (итерации пока не будет ок)
      
   В) Архитектурные проблемы → Developer эскалирует к Tech Lead
      Вы → Tech Lead решает или эскалирует к Architect
      Вы → Tech Lead обновляет task_brief
      Вы → Developer продолжает
      ...
```

## Эскалация проблем

### Когда агент эскалирует

Иногда агент не может продолжить работу без решения вопроса:

**Developer → Tech Lead** (вопросы по задаче):
- Developer создает `01_tasks/NNN/_questions_tech_lead.md`
- Tech Lead отвечает или обновляет task_brief
- Tech Lead возвращает Developer

**Tech Lead → Architect** (архитектурные решения):
- Tech Lead создает `00_docs/architecture/_questions_architect.md`
- Architect принимает решение + ADR
- Architect возвращает Tech Lead

## Смена агента в той же роли

Если контекст агента заполнился и он начинает "тупить":

1. В текущей сессии агента напишите: `/project:handoff-role`
2. Агент создаст файл передачи дел (например `_developer_handoff.md`)
3. Агент сгенерирует промпт для преемника
4. Скопируйте промпт и запустите в **новой сессии**

## Сохранение истории диалога

### Когда использовать

**Офф-топик обсуждения:**
Вы работаете с агентом и хотите обсудить альтернативный подход, но не хотите чтобы это обсуждение влияло на дальнейшую работу.

**Сохранение контекста:**
Важное обсуждение с агентом, которое может пригодиться позже.

### Как это работает

**1. Экспортируйте текущий диалог:**
- В Claude.ai: кнопка "..." → "Export conversation"
- В Claude Code: история чата доступна в интерфейсе

**2. Сохраните в `.agents/history/`:**
```
.agents/history/
└── 2026-01-18_developer_graphql-discussion.txt
```

**Формат имени:** `YYYY-MM-DD_роль_тема.txt`

**3. Запустите новую сессию агента:**
```
Ты — Developer (см. .agents/developer.md).

Прочитай историю диалога из .agents/history/2026-01-18_developer_graphql-discussion.txt для контекста.

Обсуди со мной: использование GraphQL вместо REST.

Это обсуждение альтернатив. Не принимай окончательные решения.
```

**4. После обсуждения:**
- Если решение принято → обновите файлы задачи (implementation)
- Если это был офф-топик → просто закройте сессию, не сохраняя изменения

### Примеры использования

**Пример 1: Офф-топик**
```
Developer работает над REST API
→ Экспорт истории в .agents/history/
→ Новая сессия: обсудить GraphQL
→ Решили остаться на REST
→ Закрыли сессию (история в .agents/history/, основная работа не затронута)
```

**Пример 2: Важное обсуждение**
```
Architect обсуждает архитектуру
→ Экспорт истории в .agents/history/
→ Продолжение в другой день
→ Новая сессия читает историю и продолжает
```

## Параллельная работа (Worktree)

Для параллельной работы над независимыми задачами используйте git worktree:

```
# Architect создает worktree
Создай worktree experiment на ветке experiment
```

Worktree создает отдельную рабочую директорию (например `.worktrees/experiment/` на ветке `experiment`). В ней работа идет как обычно: Developer → Reviewer.

**Когда использовать:**
- Параллельная работа (одна задача на review, начинаем другую)
- Проверка гипотез (тестирование разных подходов)
- Срочные правки (hotfix пока feature в разработке)

**После завершения:** Architect мержит ветку в main и удаляет worktree.

**Подробности:** `.claude/skills/worktree/SKILL.md`

## Структура файлов проекта

```
.agents/                # Описания ролей агентов
├── architect.md
├── tech-lead.md
├── developer.md
├── reviewer.md
└── history/            # Сохраненные истории диалогов

.claude/
├── commands/           # Слеш-команды
│   └── handoff-role.md
└── skills/            # Skills для агентов
    ├── handoff/
    ├── project-review/
    └── worktree/

.worktrees/            # Git worktrees (параллельная работа с ветками)
└── branch-name/       # Worktree на ветке branch-name

00_docs/
├── architecture/      # Архитектурные документы
│   ├── overview.md    # Общая архитектура
│   ├── implementation_plan.md  # План реализации от Tech Lead
│   └── decision_NNN_название.md  # ADR (архитектурные решения)
├── standards/         # Стандарты (читают агенты)
│   ├── common/       # Для всех ролей
│   ├── architect/    # Для Architect
│   ├── tech-lead/    # Для Tech Lead
│   ├── developer/    # Для Developer
│   └── reviewer/     # Для Reviewer
└── backlog.md        # Реестр задач

01_tasks/             # Задачи
└── NNN_название/     # Папка задачи (NNN = 001, 002...)
    ├── task_brief_01.md         # Постановка от Tech Lead
    ├── implementation_01.md     # Отчет Developer
    ├── review_01.md            # Отчет Reviewer
    ├── implementation_02.md    # При итерации
    ├── review_02.md           # При итерации
    └── _questions_tech_lead.md  # Эскалация от Developer

02_src/               # Исходный код

03_data/              # Данные - исходные и результаты работы алгоритмов
└── NN_название/      # Папки нумеруются по конвенции проекта

04_logs/              # Логи работы алгоритмов для отладки и мониторинга

AGENTS.md             # Специфика проекта для агентов
README.md             # Этот файл (для людей)
```

## Правила нумерации файлов

**Все файлы задачи используют единую нумерацию:**
- Первая версия: `_01` (task_brief_01, implementation_01, review_01)
- При итерации: `_02`, `_03` и т.д.
- `implementation_NN` и `review_NN` всегда имеют одинаковый NN

**Служебные файлы** начинаются с `_`:
- `_questions_*.md` - вопросы для эскалации
- `_*_handoff.md` - передача дел между агентами
- Эти файлы можно удалять после завершения работы

## Примеры команд

### Начать новый проект
```
Ты — агент Architect (см. .agents/architect.md).

Прочитай:
- .agents/architect.md
- AGENTS.md
- Все файлы из 00_docs/standards/common/
- Все файлы из 00_docs/standards/architect/

Задача: Обсуди со мной проект [название] и создай архитектуру.
```

### Создать задачу
```
Создай задачу: [описание что нужно сделать]
```

### Принять архитектурное решение
```
Мне нужно решить: [архитектурный вопрос]
```

### Посмотреть статус задач
```
Покажи статус задач из backlog
```

## Принципы работы

### 1. Достаточность + Лаконичность
Все документы должны быть:
- **Достаточными** для понимания
- **Лаконичными** - без воды, дублей, разжевывания

### 2. Конкретика
- Не "релевантные файлы", а конкретные пути
- Не "может быть проблема", а конкретная проблема с файлом:строкой
- Не "общие советы", а специфика ЭТОЙ задачи

### 3. Единая нумерация
- Все файлы начинаются с `_01`
- При итерации - инкремент (`_02`, `_03`)
- Синхронная нумерация в рамках одной итерации

### 4. Эскалация
- Агенты эскалируют через файлы `_questions_*.md`
- Вы копируете промпты и передаете между агентами
- Агенты возвращаются к работе после получения ответа

### 5. Итеративность
- Reviewer может вернуть задачу на доработку
- Нумерация инкрементируется при каждой итерации
- История сохраняется через версии файлов

## Часто задаваемые вопросы

**Q: Агенты общаются напрямую?**
A: Нет. Вы копируете промпты и передаете между агентами.

**Q: Как понять кому передавать задачу?**
A: Агент всегда генерирует промпт для следующего агента. Просто копируйте его.

**Q: Что если агент начал "тупить"?**
A: Используйте `/project:handoff-role` для смены агента в той же роли.

**Q: Нужно ли создавать тесты?**
A: Только если вы явно попросите. По умолчанию Developer не создает тесты.

**Q: Что если нужно изменить архитектуру?**
A: Обратитесь к Architect, он создаст/обновит ADR и передаст задачу дальше.

## Дополнительная информация

- Стандарты проекта: `00_docs/standards/`
- Описания ролей: `.agents/`
- Архитектура: `00_docs/architecture/overview.md`
- Backlog: `00_docs/backlog.md`
